<% layout('layout') %>

<script src="js/alertify.min.js"></script>
<link rel="stylesheet" href="stylesheets/alertify.core.css"/>
<link rel="stylesheet" href="stylesheets/alertify.bootstrap.css"/>

<form class="form-horizontal">
    <!--RoomName-->
    <div class="form-group">
        <label for="insert-name" class="col-sm-3 control-label" style="color: #ffffff">ROOMNAME</label>

        <div class="col-xs-3">
            <input type="text" class="form-control" name="roomname" id="roomname" placeholder="insert "
                   onkeydown="checkscript1()" style="ime-mode:disabled;">
        </div>
    </div>
    <!--RoomNameCheckButton-->
    <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
            <button type="button" onclick="checkRoomName()" class="btn btn-default">Check RoomName</button>
        </div>
    </div>
    <!--RoomGame-->
    <div class="form-group">
        <label for="insert-game" class="col-sm-3 control-label" style="color: #ffffff">Game</label>

        <div class="col-xs-4">
            <select class="form-control" id="insert_game" name="insert_game">
                <option value="select">select</option>
                <option value="Bubble Bobble">Bubble Bobble</option>
                <option value="Contra">Contra</option>
                <option value="Donkey Kong">Donkey Kong</option>
                <option value="Mario Bros">Mario Bros</option>
                <option value="Mega Man">Mega Man</option>
                <option value="Super Mario Bros3">Super Mario Bros3</option>
            </select>
        </div>
    </div>
    <!--RoomPlayerCount-->
    <div class="form-group">
        <label for="insert-player" class="col-sm-3 control-label" style="color: #ffffff">1P / 2P</label>

        <div class="col-xs-4">
            <select class="form-control" id="insert_player" name="insert_player">
                <option value="select">select</option>
                <option value="1">1P</option>
                <option value="2">2P</option>
            </select>
        </div>
    </div>
    <br/>
    <br/>
    <!--RoomCreateButton-->
    <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
            <button type="button" class="btn btn-default" onclick="CreateRoomPost()">Create</button>
        </div>
    </div>
</form>

<script>
    var check = false;

    function checkRoomName() {
        var roomname = $('#roomname').val();
        roomname.toLowerCase();
        if (roomname === '') {
            alertify.alert('Please enter RoomName', function () {
                //after clicking OK
                check = false;
            });
        }
        else {
            $.get('/CHECKROOMNAME?id=' + roomname, function (data, err) {
                if (data === 'true') {
                    $('#roomname').val('');
                    alertify.alert('RoomName already exists. Please enter another RoomName', function () {
                        //after clicking OK
                        check = false;
                    });
                }
                else {
                    alertify.alert('You can use this RoomName', function () {
                        //after clicking OK
                        check = true;
                    });
                }
            });
        }
    }
    function CreateRoomPost() {
        var insert_player = $('#insert_player').val();
        var game = $('#insert_game').val();
        if (check === false) {
            alertify.alert('Please Check RoomName!', function () {
                //after clicking OK
            });
        } else if (game === 'select') {
            alertify.alert('Please Game Select!', function () {
                //after clicking OK
            });
        } else if (insert_player === 'select') {
            alertify.alert('Please 1P/2P Select', function () {
                //after clicking OK
            });
        } else {
            var oForm = document.createElement('form');
            oForm.method = "post";
            oForm.action = "/ROOM_ADMIN";
            var objs = document.createElement("input");
            objs.setAttribute('type', 'hidden');
            objs.setAttribute('name', 'roomname');
            objs.setAttribute('value', $('#roomname').val().toLowerCase());
            oForm.appendChild(objs);
            var objs1 = document.createElement("input");
            objs1.setAttribute('type', 'hidden');
            objs1.setAttribute('name', 'game');
            objs1.setAttribute('value', $('#insert_game').val());
            oForm.appendChild(objs1);
            var objs2 = document.createElement("input");
            objs2.setAttribute('type', 'hidden');
            objs2.setAttribute('name', 'playerCount');
            objs2.setAttribute('value', $('#insert_player').val());
            oForm.appendChild(objs2);
            oForm.submit();
        }
    }

    function checkscript1(){
        var script = $('#roomname').val();

        if( (script.search("<") != -1) || (script.search(">") != -1) ) {
            alertify.alert('cannot use < > sign', function () {
                //after clicking OK
                $('#roomname').val('');
            });
        }
    }
</script>