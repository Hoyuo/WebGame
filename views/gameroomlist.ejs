<% layout('layout') %>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">
    function RoomJoin(roomname, game, playerCount, limitCount) {
        if (playerCount + 1 > limitCount) {
            alert("방이 꽉 찾습니다");
            return false;
        }
        var ret = confirm("방을 입장하시겠습니까?");
        if (ret === true) {
            var oForm = document.createElement('form');
            oForm.method = "post";
            oForm.action = "/JOIN_ROOM";
            var objs = document.createElement("input");
            objs.setAttribute('type', 'hidden');
            objs.setAttribute('name', 'roomname');
            objs.setAttribute('value', roomname);
            oForm.appendChild(objs);
            var objs1 = document.createElement("input");
            objs1.setAttribute('type', 'hidden');
            objs1.setAttribute('name', 'game');
            objs1.setAttribute('value', game);
            oForm.appendChild(objs1);
            var objs2 = document.createElement("input");
            objs2.setAttribute('type', 'hidden');
            objs2.setAttribute('name', 'playerCount');
            objs2.setAttribute('value', playerCount);
            oForm.appendChild(objs2);
            oForm.submit();
        }
    }
    function CreateRoom() {
        location.href = "/CREATEROOM";
    }
    $(function () {
        var socket = io.connect();
        socket.emit('request_room_list');

        socket.on('roomlist', function (data) {
            for (var i = 0; i < data.length; i++) {
                var tag =
                        "<tr onclick='RoomJoin(\"" +
                        data[i].roomname + "\", \"" +
                        data[i].game + "\"," +
                        data[i].no_of_persons + "," +
                        data[i].playerCount +
                        ")'>" +
                        '<td>' + data[i].roomname + '</td>' +
                        '<td>' + (i + 1) + '</td>' +
                        '<td>' + data[i].game + '</td>' +
                        '<td>' + data[i].playerCount + 'P' + '</td></tr>';
                $(tag).appendTo('#gamelist');
            }
            socket.disconnect();
        });

    });
</script>

<div>
    <div class="col-xs-2">
        <button onclick="CreateRoom()" style="background-color: #000080; color: #FFF">Create</button>
    </div>
    <div class="modal-content col-xs-10">
        <div class="modal-header">
            <h4 class="modal-title">Room List</h4>
        </div>

        <table id="gamelist" class="table table-hover">
            <thead>
            <tr>
                <th class="col-xs-7">ROOM NAME</th>
                <th class="col-xs-1">NUMBER</th>
                <th class="col-xs-3">GAME</th>
                <th class="col-xs-1">1P/2P</th>
            </tr>
            </thead>
        </table>
    </div>

</div>